# Занятие 10 - Словари и хеш-таблицы

## Применение структур типа ключ-значение

- основная структура данных во многих динамических языках (т.н. объект), таких как JS и Lua
- key-value store
- представление любых словарей (например, в лингвистике)
- эффективная реализация множеств
- мемоизация


## Варианты реализации структуры типа ключ-значение

- список/массив пар
- хеш-таблица
- дерево поиска


## Хеш-таблица

Хеш-таблицы — это основанные на массивах структуры данных, которые имеют амортизированную сложность всех основных операций — O(1). Однако это происходит за счет следующих особенностей:

- данные в хеш-таблице не могут быть упорядоченны произвольным образом
- хотя время доступа к элементам и является константой, но сама константа может быть достаточно большой
- в хеш-таблицах, как правило, происходит не полностью эффективное использование памяти (потери могут составлять от 30 до 60%) 
- таблицы не поддерживают эффективно такие операции как поиск наибольшего элемента

Хеш-таблица получается из массива добавлением операции хеширования ключа, в результате которой можно узнать элемент массива, где должна находится пара ключ-значение. При этом разные ключи могут давать одинаковый хеш код, что приводит к коллизиям (невозможности запистаь или анйти элемент в точности в указанной хеш-функццией ячейке). 

Варианты реализации хеш-таблиц с учетом борьбы с коллизиями:

- цепная: если в какую-то ячейку долен быть записан более, чем 1 экземпляр данных, то эти данные размещаются в дополнительной структуре, которая может быть:
  - связным списком/динамическим массивом
  - деревом
  - еще одной зеш-таблицей с другой хеш-функцией
- открытая адресация: если ячейка заняты, то мы смотрим на соседей и ищем среди них пустую ячейку или же нужный нам ключ и так по рекурсии. Варианты реализации:
  - линейная/квадратичная
  - двойное хеширование
  - гибрид линейной модели и двойного хеширования
  - кукушечная
  - hopscotch
  - 2-х вариантный

Цепная реализация хеш-таблиц позволяет хранить в таблице неограниченный объем данных, но в этом случае таблица вырождается в множество списков или деревьев.

Хеш-таблицы с открытой адресацией более простые и эффективные, но могут хранить не больше значений, чем размер массива. При этом при превішении заполненности массива 0.7-0.8 у них очень падает производительность. Они требуют расширения (для этого также есть разные стратегии).


## Хеш-функции

[Парадокс дней рождения](http://betterexplained.com/articles/understanding-the-birthday-paradox/)

Задачи (некриптографической) хеш-функции:

- сократить диапазон ключей до размера массива хеш-таблицы
- перераспределить ключи примерно равномерно
- при этом хеши соседних ключей должны, в идеале, оказаться далеко друг от друга

Простейший вариант хеш-функции: битовая маска, которая берет только несколько бит из численного представления данных.

Большинство хеш-функций используют последовательное преобразование данных путем сложения, усножения и операции xor с последующим делением по модулю, чтобы результат оказался в требуемом интервале.

Хеш-функции, как правило, являются необратимыми.

См. также:

- идеальное хеширование
- консистентное хеширование


## To read

- http://stackoverflow.com/questions/10256974/under-the-hood-are-javascript-objects-hash-tables
- http://stackoverflow.com/questions/2624192/good-hash-function-for-strings
- http://computinglife.wordpress.com/2008/11/20/why-do-hash-functions-use-prime-numbers/
- http://isthe.com/chongo/tech/comp/fnv/
- http://stackoverflow.com/questions/21126507/why-does-sxhash-return-a-constant-for-all-structs
